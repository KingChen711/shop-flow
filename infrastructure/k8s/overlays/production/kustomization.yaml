# Production Environment Overlay
# Uses AWS RDS for databases with high availability
apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

namespace: shopflow

resources:
  - ../../base
  # RDS connection secrets (managed by AWS Secrets Manager / External Secrets)
  - secrets/rds-secrets.yaml
  # ExternalName services pointing to RDS
  - secrets/rds-services.yaml

commonLabels:
  environment: production

# Patches for production environment
patches:
  # Set replicas to 3 for production
  - patch: |-
      - op: replace
        path: /spec/replicas
        value: 3
    target:
      kind: Deployment
      labelSelector: 'app.kubernetes.io/part-of=shopflow-platform'

  # Increase resources for production
  - patch: |-
      - op: replace
        path: /spec/template/spec/containers/0/resources/requests/cpu
        value: 250m
      - op: replace
        path: /spec/template/spec/containers/0/resources/requests/memory
        value: 256Mi
      - op: replace
        path: /spec/template/spec/containers/0/resources/limits/cpu
        value: 1000m
      - op: replace
        path: /spec/template/spec/containers/0/resources/limits/memory
        value: 1Gi
    target:
      kind: Deployment
      labelSelector: 'app.kubernetes.io/part-of=shopflow-platform'

# ConfigMap overrides for production
configMapGenerator:
  - name: production-config
    literals:
      - NODE_ENV=production
      - LOG_LEVEL=warn

# Image tags for production (use specific versions, not latest)
images:
  - name: shopflow/user-service
    newTag: v1.0.0
  - name: shopflow/product-service
    newTag: v1.0.0
  - name: shopflow/order-service
    newTag: v1.0.0
  - name: shopflow/inventory-service
    newTag: v1.0.0
  - name: shopflow/payment-service
    newTag: v1.0.0
  - name: shopflow/notification-service
    newTag: v1.0.0
  - name: shopflow/search-service
    newTag: v1.0.0
  - name: shopflow/cart-service
    newTag: v1.0.0
  - name: shopflow/api-gateway
    newTag: v1.0.0
